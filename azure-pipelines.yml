

trigger:
- main

resources:
- repo: self

variables:
  tag: '$(Build.BuildId)'

stages:
- stage: Build
  displayName: Build image
  jobs:
  - job: Build
    displayName: Build
    pool:
      vmImage: ubuntu-latest
    steps:
    - task: Docker@2
      displayName: Build an image
      inputs:
        command: build
        dockerfile: '$(Build.SourcesDirectory)/dockerfile'
        tags: |
          $(tag)
    - task: deploye
      displayName: Deploy
      uses: ssh-action@master
      with:
        host: ${User_HOST}
        username: ${USERNAME }
        key: ${PRIVATE_KEY }
        script: |
          docker stop dataprocess || true
          docker rm dataprocess || true
          git pull origin main
          docker run -d --name dataprocess
  

